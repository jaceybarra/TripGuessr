<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TripGuessr – Daily Driving Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- =========================
       Styles
  ========================== -->
  <style>
    :root {
      --bg: #f9fafb;
      --text: #111827;
      --muted: #6b7280;
      --card: #ffffff;
      --primary: #2563eb;
      --primary-contrast: #ffffff;
      --accent: #10b981;
      --danger: #ef4444;
      --shadow: 0 8px 30px rgba(0,0,0,0.08);
      --ring: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }
    .dark {
      --bg: #0d0f13;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --card: #12161c;
      --primary: #60a5fa;
      --primary-contrast: #0b1220;
      --accent: #34d399;
      --danger: #f87171;
      --shadow: 0 8px 30px rgba(0,0,0,0.35);
      --ring: 0 0 0 3px rgba(96, 165, 250, 0.25);
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      transition: background .25s ease, color .25s ease;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--card);
      border-bottom: 1px solid rgba(0,0,0,0.05);
      box-shadow: var(--shadow);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 16px 20px; }
    .row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; }
    .logo { width: 48px; height: 48px; }
    .title-wrap h1 { font-size: 1.25rem; margin: 0; }
    .title-wrap p { margin: 2px 0 0 0; color: var(--muted); font-size: .9rem; }

    /* Controls */
    .controls { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .btn {
      border: none; background: var(--primary); color: var(--primary-contrast);
      padding: 10px 14px; border-radius: 10px; font-weight: 600; cursor: pointer;
    }
    .btn.secondary { background: transparent; color: var(--text); border: 1px solid rgba(0,0,0,.1); }

    /* Layout */
    .grid { display: grid; grid-template-columns: 1.45fr 1fr; gap: 18px; }
    @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } }

    /* Map */
    #map { width: 100%; height: 520px; border-radius: 16px; background: #dfe7f3; box-shadow: var(--shadow); }

    /* Cards */
    .card { background: var(--card); border-radius: 16px; box-shadow: var(--shadow); padding: 16px; margin-top: 12px; }
    .guess-panel { border: 2px dashed rgba(37,99,235, .35); border-radius: 16px; padding: 18px; }

    .input-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .input { display: inline-flex; align-items: center; background: var(--bg); border: 1px solid rgba(0,0,0,.08); padding: 12px 14px; border-radius: 12px; }
    .input input { border: none; background: transparent; color: var(--text); width: 120px; font-size: 1.1rem; }
    .result { margin-top: 12px; font-weight: 700; }
    .result.ok { color: var(--accent); }
    .result.no { color: var(--danger); }
    .result.near { color: #f59e0b; }

    .email-row { display: grid; grid-template-columns: 1fr auto; gap: 10px; }
    .report-block pre { background: var(--bg); padding: 12px; border-radius: 12px; white-space: pre-wrap; }

    .table { width: 100%; border-collapse: collapse; font-size: .95rem; }
    .table th, .table td { padding: 8px 10px; border-bottom: 1px solid rgba(0,0,0,.06); }
    .table th { color: var(--muted); font-weight: 700; font-size: .85rem; }
    .tag { padding: 2px 6px; border-radius: 6px; font-size: .8rem; }
    .tag.lose { background: #fdd; color: #900; }
    .tag.near { background: #ffd; color: #990; }
    .tag.win { background: #dfd; color: #090; }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="30" fill="#2563eb"/>
      <text x="32" y="39" text-anchor="middle" font-weight="800" font-size="16" fill="#fff">TG</text>
    </svg>
    <div class="title-wrap">
      <h1>TripGuessr</h1>
      <p>Guess today’s drive time. Within 10% counts as a win.</p>
    </div>
  </div>
  <div class="controls">
    <button id="themeBtn" class="btn secondary">Dark</button>
    <button id="reportBtn" class="btn secondary">Download CSV</button>
  </div>
</header>

<main class="container" style="padding: 18px;">
  <div class="grid">
    <section>
      <div id="map"></div>
    </section>
    <aside>
      <div class="card guess-panel">
        <h2>Enter Your Guess</h2>
        <div class="input-row">
          <div class="input">
            <input id="guessInput" type="number" placeholder="e.g., 42" />
            <span>minutes</span>
          </div>
          <button id="submitBtn" class="btn">Submit Guess</button>
        </div>
        <div id="result" class="result"></div>
      </div>
      <div class="card">
        <h2>Track Your Progress</h2>
        <div class="email-row">
          <input id="emailInput" type="email" placeholder="you@example.com" />
          <button id="saveEmailBtn" class="btn secondary">Save Email</button>
        </div>
        <button id="viewReportBtn" class="btn secondary">View Report</button>
        <div id="reportBlock" style="display:none;"><pre id="reportText"></pre></div>
      </div>
      <div class="card">
        <h2>Your Recent Results</h2>
        <table class="table" id="recentTable">
          <thead><tr><th>Date</th><th>Guess</th><th>Outcome</th><th>Diff</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </aside>
  </div>
</main><script>
const TOLERANCE_PERCENT = 10;
const DEVICE_RESULTS_KEY = "tg_device_results";
const EMAIL_KEY = "tg_email";
let ACTUAL_MINUTES = null;

// --- Helpers ---
function todayKey(){ const d=new Date(); return d.toISOString().slice(0,10);}
function saveJSON(key,obj){ localStorage.setItem(key,JSON.stringify(obj));}
function loadJSON(key,fallback){ try{const s=localStorage.getItem(key); return s?JSON.parse(s):fallback;}catch(e){return fallback;}}

// --- Dark/Light toggle ---
document.getElementById("themeBtn").onclick=()=>{document.body.classList.toggle("dark");};

// --- Estimate fallback (if route fails) ---
function estimateByAir(a,b){
  const R=6371,toRad=d=>d*Math.PI/180;
  const dLat=toRad(b.lat-a.lat),dLng=toRad(b.lng-a.lng);
  const s1=Math.sin(dLat/2)**2+Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*Math.sin(dLng/2)**2;
  const km=2*R*Math.asin(Math.sqrt(s1)); const miles=km*0.621371; return Math.round((miles/60)*60);
}

// --- Pick daily pair of cities (deterministic-ish) ---
function pickDailyPair(){
  const CITIES=[
    {lat:37.7749,lng:-122.4194}, // SF
    {lat:34.0522,lng:-118.2437}, // LA
    {lat:40.7128,lng:-74.0060},  // NYC
    {lat:41.8781,lng:-87.6298},  // Chicago
    {lat:29.7604,lng:-95.3698},  // Houston
    {lat:47.6062,lng:-122.3321}  // Seattle
  ];
  const seed=todayKey().split("-").join("");
  const i=parseInt(seed.slice(-2))%CITIES.length;
  const j=(i+2)%CITIES.length;
  return {origin:CITIES[i],destination:CITIES[j]};
}

// --- Init Google Map ---
window.initMap=function(){
  const map=new google.maps.Map(document.getElementById("map"),{zoom:5,center:{lat:39.5,lng:-98.35}});
  const {origin,destination}=pickDailyPair();
  new google.maps.Marker({position:origin,map,label:"A"});
  new google.maps.Marker({position:destination,map,label:"B"});
  ACTUAL_MINUTES=estimateByAir(origin,destination);
};

// --- Guess submission ---
document.getElementById("submitBtn").onclick=()=>{
  const guess=parseInt(document.getElementById("guessInput").value,10);
  const resEl=document.getElementById("result");
  if(!ACTUAL_MINUTES){resEl.textContent="Route loading";return;}
  if(isNaN(guess)||guess<=0){resEl.textContent="Enter valid number";return;}
  const pct=Math.abs(guess-ACTUAL_MINUTES)/ACTUAL_MINUTES;
  const diff=Math.abs(guess-ACTUAL_MINUTES);
  if(pct<=TOLERANCE_PERCENT/100){
    resEl.textContent=`✅ Correct within 10%! Actual ${ACTUAL_MINUTES} min`;
    resEl.className="result ok";
  } else if(pct<=0.15){
    resEl.textContent=`⚠️ So close! Off by ${diff} min`;
    resEl.className="result near";
  } else {
    resEl.textContent=`❌ Off by ${diff} min`;
    resEl.className="result no";
  }
  const data=loadJSON(DEVICE_RESULTS_KEY,[]);
  data.push({date:todayKey(),guess,actual:ACTUAL_MINUTES,diff});
  saveJSON(DEVICE_RESULTS_KEY,data);
  renderRecent();
};

// --- Recent results ---
function renderRecent(){
  const tbody=document.querySelector("#recentTable tbody"); tbody.innerHTML="";
  const data=loadJSON(DEVICE_RESULTS_KEY,[]).slice(-10).reverse();
  data.forEach(row=>{
    const outcome = row.diff<=ACTUAL_MINUTES*0.1
      ? "<span class='tag win'>Win</span>"
      : row.diff<=ACTUAL_MINUTES*0.15
        ? "<span class='tag near'>Near</span>"
        : "<span class='tag lose'>Miss</span>";
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${row.date}</td><td>${row.guess}</td><td>${outcome}</td><td>${row.diff}</td>`;
    tbody.appendChild(tr);
  });
}
renderRecent();

// --- Email save & report ---
document.getElementById("saveEmailBtn").onclick=()=>{
  localStorage.setItem(EMAIL_KEY,document.getElementById("emailInput").value);
  alert("Email saved");
};
document.getElementById("viewReportBtn").onclick=()=>{
  const data=loadJSON(DEVICE_RESULTS_KEY,[]); const lines=["date,guess,actual,diff"];
  data.forEach(r=>lines.push(`${r.date},${r.guess},${r.actual},${r.diff}`));
  document.getElementById("reportText").textContent=lines.join("\n");
  document.getElementById("reportBlock").style.display="block";
};
document.getElementById("reportBtn").onclick=()=>{
  const data=loadJSON(DEVICE_RESULTS_KEY,[]); let csv="date,guess,actual,diff\n";
  data.forEach(r=>csv+=`${r.date},${r.guess},${r.actual},${r.diff}\n`);
  const blob=new Blob([csv],{type:"text/csv"}); const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="tripguessr.csv"; a.click();
};
</script>

<!-- =========================
     Google Maps JS
     Replace YOUR_REAL_API_KEY_HERE below
========================== -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJhWz8jA_KfdQCZ1jE_z8RPGuvcQBVKFM&callback=initMap"></script>
</body>
</html>
